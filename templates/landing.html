{% extends "base.html" %}

{% block title %}CareSync AI - Autonomous Patient Care Coordination System{% endblock %}

{% block body_class %}landing-page{% endblock %}

{% block content %}
<div class="landing-container">
    <div class="landing-hero">
        <div class="hero-content">
            <div class="logo-container">
                <i class="bi bi-heart-pulse-fill logo-icon"></i>
                <h1 class="brand-name">CareSync AI</h1>
            </div>
            <p class="tagline">Autonomous Patient Care Coordination System</p>
            <p class="description">
                Real-time patient monitoring, AI-powered risk detection, and instant emergency alerts
            </p>
            
            <div class="row mt-5">
                <div class="col-lg-6">
                    <div class="feature-cards">
                        <div class="feature-card">
                            <i class="bi bi-activity"></i>
                            <h3>Real-Time Monitoring</h3>
                            <p>Continuous vital sign tracking</p>
                        </div>
                        <div class="feature-card">
                            <i class="bi bi-bell-fill"></i>
                            <h3>Instant Alerts</h3>
                            <p>Emergency notifications instantly</p>
                        </div>
                        <div class="feature-card">
                            <i class="bi bi-brain"></i>
                            <h3>AI Risk Detection</h3>
                            <p>Predictive analytics for early warnings</p>
                        </div>
                    </div>
                </div>
                
                <div class="col-lg-6">
                    <div class="row">
                        <div class="col-12 mb-3">
                            <div class="login-card-inline">
                                <div class="login-header">
                                    <h5>Staff Portal Login</h5>
                                    <p class="text-muted small">Admin • Doctor • Nurse</p>
                                </div>
                                
                                <form method="POST" action="{{ url_for('staff_login') }}" class="login-form">
                                    <div class="mb-3">
                                        <label for="staff_id" class="form-label">Staff ID</label>
                                        <input type="text" class="form-control" id="staff_id" name="staff_id" 
                                               placeholder="e.g., ADM0001" required>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="password" class="form-label">Password</label>
                                        <input type="password" class="form-control" id="password" name="password" 
                                               placeholder="Enter password" required>
                                    </div>
                                    
                                    <button type="submit" class="btn btn-primary w-100">
                                        <i class="bi bi-box-arrow-in-right me-2"></i>Login
                                    </button>
                                </form>
                                
                                <div class="text-center mt-3">
                                    <a href="{{ url_for('view_credentials') }}" class="btn btn-link btn-sm">
                                        <i class="bi bi-key"></i> View Demo Credentials
                                    </a>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-12">
                            <div class="login-card-inline discharged-card">
                                <div class="login-header">
                                    <h5><i class="bi bi-robot me-2"></i>CareSync AI Assistant</h5>
                                    <p class="text-muted small">Post-Discharge Care Support</p>
                                </div>
                                
                                <p class="small text-muted mb-3">
                                    <i class="bi bi-info-circle me-2"></i>Discharged patients can access personalized AI-powered support for medication guidance, follow-up care, and health concerns.
                                </p>
                                
                                <a href="{{ url_for('discharged_portal') }}" class="btn btn-info w-100">
                                    <i class="bi bi-chat-dots me-2"></i>Access AI Assistant
                                </a>
                                
                                <div class="text-center mt-2">
                                    <small class="text-muted">
                                        <i class="bi bi-globe me-1"></i>Available in 5 languages
                                    </small>
                                </div>
                            </div>
                        </div>

                        <div class="col-12 mt-3">
                            <div class="login-card-inline" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; border: 2px solid rgba(255,255,255,0.3);">
                                <div class="login-header">
                                    <h5><i class="bi bi-calendar-check me-2"></i>Book an Appointment</h5>
                                    <p class="text-muted small" style="color: rgba(255,255,255,0.9) !important;">Direct Booking for New or Existing Patients</p>
                                </div>
                                
                                <p class="small mb-3" style="color: rgba(255,255,255,0.9) !important;">
                                    <i class="bi bi-info-circle me-2"></i>Intelligent doctor matching based on your needs. Quick and easy online booking.
                                </p>
                                
                                <button class="btn btn-light w-100" data-bs-toggle="modal" data-bs-target="#appointmentModal">
                                    <i class="bi bi-calendar-plus me-2"></i>Book Appointment
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="cta-buttons mt-4">
                <a href="{{ url_for('init_data') }}" class="btn btn-outline-primary">
                    <i class="bi bi-database-fill-gear me-2"></i>Initialize Demo Data
                </a>
            </div>
        </div>
    </div>

    <!-- Direct Appointment Booking Modal -->
    <div class="modal fade" id="appointmentModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-gradient" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; border: none;">
                    <h5 class="modal-title"><i class="bi bi-calendar-check me-2"></i>Book an Appointment</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="appointmentForm">
                        <!-- Patient Info Section -->
                        <div class="card mb-3 border-light">
                            <div class="card-header bg-light"><strong>Your Information</strong></div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">First Name *</label>
                                        <input type="text" id="firstName" class="form-control" required>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Last Name *</label>
                                        <input type="text" id="lastName" class="form-control" required>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Phone Number *</label>
                                        <input type="tel" id="phone" class="form-control" required>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Email (Optional)</label>
                                        <input type="email" id="email" class="form-control">
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Date of Birth</label>
                                        <input type="date" id="dob" class="form-control">
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Gender</label>
                                        <select id="gender" class="form-select">
                                            <option value="Other">Prefer not to say</option>
                                            <option value="Male">Male</option>
                                            <option value="Female">Female</option>
                                            <option value="Other">Other</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Appointment Details Section -->
                        <div class="card mb-3 border-light">
                            <div class="card-header bg-light"><strong>Appointment Details</strong></div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Preferred Date *</label>
                                        <input type="date" id="apptDate" class="form-control" required>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Preferred Time *</label>
                                        <input type="time" id="apptTime" class="form-control" required>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Department *</label>
                                        <select id="apptDept" class="form-select" required>
                                            <option value="">Select Department</option>
                                            <option value="General">General Medicine</option>
                                            <option value="Cardiology">Cardiology</option>
                                            <option value="Neurology">Neurology</option>
                                            <option value="Surgery">General Surgery</option>
                                            <option value="ICU">Intensive Care Unit</option>
                                            <option value="Emergency">Emergency Department</option>
                                            <option value="Pediatrics">Pediatrics</option>
                                            <option value="Orthopedics">Orthopedics</option>
                                            <option value="Psychiatry">Psychiatry</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Appointment Type *</label>
                                        <select id="apptType" class="form-select" required>
                                            <option value="routine">Routine Checkup</option>
                                            <option value="consultation">Consultation</option>
                                            <option value="follow-up">Follow-up Visit</option>
                                            <option value="diagnostic">Diagnostic Test</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Reason for Visit / Symptoms *</label>
                                    <textarea id="apptReason" class="form-control" rows="3" required placeholder="Describe your symptoms or reason for visit..."></textarea>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Urgency Level</label>
                                    <select id="apptUrgency" class="form-select">
                                        <option value="normal">Normal</option>
                                        <option value="urgent">Urgent</option>
                                        <option value="emergency">Emergency</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Preferred Language</label>
                                    <select id="apptLanguage" class="form-select">
                                        <option value="en">English</option>
                                        <option value="hi">हिन्दी (Hindi)</option>
                                        <option value="te">తెలుగు (Telugu)</option>
                                        <option value="ta">தமிழ் (Tamil)</option>
                                        <option value="ml">മലയാളം (Malayalam)</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="submitApptBtn">Submit Appointment Request</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="landing-visual">
        <div class="pulse-animation">
            <div class="pulse-ring"></div>
            <div class="pulse-ring delay-1"></div>
            <div class="pulse-ring delay-2"></div>
        </div>
    </div>
</div>

<style>
.landing-container { min-height: 100vh; padding: 40px 20px; }
.hero-content { max-width: 1200px; margin: 0 auto; }
.login-card-inline { 
    background: white; 
    padding: 30px; 
    border-radius: 12px; 
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
}
.login-header h5 { color: #1a1a2e; margin-bottom: 5px; }
.login-form .form-label { font-weight: 600; color: #333; }
.login-form .form-control { border-radius: 8px; border: 1px solid #ddd; }
.feature-cards { display: grid; gap: 20px; }
.feature-card { 
    padding: 20px; 
    text-align: center; 
    background: rgba(255,255,255,0.1); 
    border-radius: 8px;
    color: white;
}
.feature-card i { font-size: 32px; margin-bottom: 10px; }
.discharged-card {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: 2px solid rgba(255,255,255,0.3);
}
.discharged-card .login-header h5,
.discharged-card .login-header p {
    color: white;
}
.discharged-card .text-muted {
    color: rgba(255,255,255,0.8) !important;
}
.discharged-card small.text-muted {
    color: rgba(255,255,255,0.9) !important;
}
.cta-buttons { text-align: center; }</style>

<script>
document.getElementById('submitApptBtn').addEventListener('click', async function() {
    const btn = this;
    btn.disabled = true;
    const originalText = btn.innerHTML;
    btn.innerHTML = '<i class="bi bi-hourglass-split me-2"></i>Submitting...';

    try {
        const formData = {
            first_name: document.getElementById('firstName').value,
            last_name: document.getElementById('lastName').value,
            phone: document.getElementById('phone').value,
            email: document.getElementById('email').value,
            dob: document.getElementById('dob').value,
            gender: document.getElementById('gender').value,
            preferred_date: document.getElementById('apptDate').value,
            preferred_time: document.getElementById('apptTime').value,
            department: document.getElementById('apptDept').value,
            appointment_type: document.getElementById('apptType').value,
            reason: document.getElementById('apptReason').value,
            urgency: document.getElementById('apptUrgency').value,
            language: document.getElementById('apptLanguage').value
        };

        // Validate required fields
        if (!formData.first_name || !formData.last_name || !formData.phone || 
            !formData.preferred_date || !formData.preferred_time || !formData.department ||
            !formData.appointment_type || !formData.reason) {
            alert('Please fill in all required fields (marked with *)');
            btn.disabled = false;
            btn.innerHTML = originalText;
            return;
        }

        const response = await fetch('/api/landing-page/book-appointment', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(formData)
        });

        if (response.ok) {
            const result = await response.json();
            alert(`Appointment request submitted successfully!\nYour confirmation code: ${result.patient_code}\nAppointment ID: #${result.appointment_id}`);
            document.getElementById('appointmentForm').reset();
            const modal = bootstrap.Modal.getInstance(document.getElementById('appointmentModal'));
            modal.hide();
        } else {
            const error = await response.json();
            alert(`Error: ${error.error || 'Failed to submit appointment'}`);
        }
    } catch (error) {
        alert('Network error. Please try again.');
        console.error('Appointment booking error:', error);
    } finally {
        btn.disabled = false;
        btn.innerHTML = originalText;
    }
});
</script>

{% endblock %}
